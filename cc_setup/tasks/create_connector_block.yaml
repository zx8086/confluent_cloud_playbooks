- name: Create Connector Block
  block:
  
    - name: Create Connector JSON Body Document For API
      set_fact:
        json_body: "{{ lookup('template', 'templates/{{item}}.j2') }}"

    - name: Debug Variable - json_body
      ansible.builtin.debug:
        var: json_body

    - name: Create Connector via API
      ansible.builtin.uri:
        url: "{{KAFKA_CLOUD_URL}}/environments/{{KAFKA_ENVIRONMENT_ID}}/clusters/{{KAFKA_CLUSTER_ID}}/connectors"
        method: POST
        # body_format: json
        headers:
          Content-Type: "application/json"
          Authorization: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          34653864363464313432323061343939663761666332386662383066306634633632303330303563
          3863643733363939396237623433343132653964653836650a663834336639653233626437656363
          37386432613961386433396366633065303163643338316338353265653562613336653033653430
          3439363630616230340a333866626263616538626637663437303261633662356237626461356137
          36653263623662363566616333343430623632363861336162303838616466376431626436393166
          30356433663163626530323431323334336336396238333466376236323539353334646466363262
          36396331393965613834353165363164396433353135626635373332636536633439353563643966
          37643766336661663061326631623561653332336437396630623137623438353435656635326639
          34333061316331653538643865393139363461303836323238346161636237323038656134336632
          3162343936633437383262393033346235616264643936663162
        body: "{{ json_body }}"
        timeout: 90
        # url_username: "{{KAFKA_CLOUD_API_KEY}}"
        # url_password: "{{KAFKA_CLOUD_API_SECRET}}"
        force: yes
        # follow_redirects: yes
        # force_basic_auth: yes
        status_code: [201, 204]
        return_content: yes
      ignore_errors: yes
      # no_log: True
      register: created_connector

    - name: Debug Variable - Create Connector via API
      ansible.builtin.debug:
        var: created_connector
